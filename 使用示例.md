# 前后端对接使用示例

## 1. 安装依赖

```bash
npm install axios
```

## 2. 配置后端接口地址

### 方式一：环境变量（推荐）
- 开发环境：修改 `.env.development` 中的 `VITE_API_BASE_URL`
- 生产环境：修改 `.env.production` 中的 `VITE_API_BASE_URL`

### 方式二：直接修改 `src/utils/request.js`
```javascript
const service = axios.create({
  baseURL: 'http://your-backend-api.com/api', // 修改这里
  // ...
})
```

## 3. 在页面中使用 API

### 示例：报表管理页面

```javascript
import { getTemplateList, createTemplate, updateTemplate, deleteTemplate } from '@/api/reportManagement'

// 获取列表
const fetchTableData = async () => {
  loading.value = true
  try {
    const response = await getTemplateList({
      page: pagination.value.currentPage,
      pageSize: pagination.value.pageSize,
      keyword: searchKeyword.value
    })
    tableData.value = response.list || response.data || response
    pagination.value.total = response.total || 0
  } catch (error) {
    ElMessage.error('数据加载失败')
  } finally {
    loading.value = false
  }
}

// 创建模板
const handleSaveRow = async (row) => {
  try {
    if (row.isNew) {
      await createTemplate({
        templateCode: row.templateCode,
        templateName: row.templateName,
        templateType: row.templateType,
        templateUrl: row.templateUrl,
        fileName: row.fileName,
        templateStatus: row.templateStatus
      })
      ElMessage.success('创建成功')
    } else {
      await updateTemplate(row.id, {
        templateName: row.templateName,
        templateUrl: row.templateUrl,
        fileName: row.fileName
      })
      ElMessage.success('更新成功')
    }
    row.isEditing = false
    row.isNew = false
    fetchTableData() // 刷新列表
  } catch (error) {
    ElMessage.error('保存失败')
  }
}

// 删除模板
const handleDeleteRow = async (row) => {
  try {
    await deleteTemplate(row.id)
    ElMessage.success('删除成功')
    fetchTableData() // 刷新列表
  } catch (error) {
    ElMessage.error('删除失败')
  }
}
```

## 4. 后端接口规范

### 统一响应格式（推荐）

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [...],
    "total": 100
  }
}
```

如果后端返回格式不同，可以修改 `src/utils/request.js` 中的响应拦截器。

## 5. 开发环境代理配置（可选）

如果后端接口有跨域问题，可以在 `vite.config.js` 中配置代理：

```javascript
export default defineConfig({
  // ...
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '')
      }
    }
  }
})
```

## 6. Token 认证

如果后端需要 Token 认证，Token 会自动从 `localStorage.getItem('token')` 获取并添加到请求头。

登录成功后，将 Token 存储到 localStorage：
```javascript
localStorage.setItem('token', 'your-token-here')
```

## 7. 文件上传示例

```javascript
import { uploadTemplateFile } from '@/api/reportManagement'

const handleFileChange = async (file, row) => {
  try {
    await uploadTemplateFile(row.id, file.raw)
    ElMessage.success('上传成功')
    fetchTableData() // 刷新列表
  } catch (error) {
    ElMessage.error('上传失败')
  }
}
```

## 8. 文件下载示例

```javascript
import { downloadTemplateFile } from '@/api/reportManagement'

const handleDownload = async (row) => {
  try {
    const blob = await downloadTemplateFile(row.id)
    const url = window.URL.createObjectURL(blob)
    const link = document.createElement('a')
    link.href = url
    link.setAttribute('download', row.fileName || 'template.xlsx')
    document.body.appendChild(link)
    link.click()
    document.body.removeChild(link)
    window.URL.revokeObjectURL(url)
  } catch (error) {
    ElMessage.error('下载失败')
  }
}
```




